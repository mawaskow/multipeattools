{% extends "base.html" %}

{% block title %}Policy Suggestion Form{% endblock %}

{% block content %}
<!-- Import Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
    /* Success Popup Styles */
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .popup-overlay.show {
        opacity: 1;
        visibility: visible;
    }

    .popup-content {
        background: white;
        border-radius: 16px;
        padding: 40px;
        max-width: 450px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        transform: scale(0.8) translateY(20px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .popup-overlay.show .popup-content {
        transform: scale(1) translateY(0);
    }

    .popup-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: #66BB6A;
    }

    .success-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        background: #66BB6A;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: scaleIn 0.5s ease 0.2s both;
    }

    .success-icon svg {
        width: 40px;
        height: 40px;
        color: white;
        stroke-width: 3;
    }

    @keyframes scaleIn {
        0% {
            transform: scale(0);
            opacity: 0;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .popup-title {
        font-size: 24px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 12px;
        animation: slideUp 0.5s ease 0.3s both;
    }

    .popup-message {
        font-size: 16px;
        color: #6b7280;
        line-height: 1.5;
        margin-bottom: 32px;
        animation: slideUp 0.5s ease 0.4s both;
    }

    @keyframes slideUp {
        0% {
            transform: translateY(20px);
            opacity: 0;
        }
        100% {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .popup-close-btn {
        background: #66BB6A;
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        animation: slideUp 0.5s ease 0.5s both;
    }

    .popup-close-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .popup-close-btn:active {
        transform: translateY(0);
    }

    /* Loading Spinner */
    .loading-spinner {
        width: 24px;
        height: 24px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid #10b981;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 8px;
        display: inline-block;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .btn-loading {
        pointer-events: none;
        opacity: 0.7;
    }

    /* Error Popup Styles */
    .error-popup .popup-content::before {
        background: #FFC107;
    }

    .error-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        background: #FFC107;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: scaleIn 0.5s ease 0.2s both;
    }

    .error-icon svg {
        width: 40px;
        height: 40px;
        color: white;
        stroke-width: 3;
    }

    .error-popup .popup-close-btn {
        background: #FFC107;
    }

    .error-popup .popup-close-btn:hover {
        box-shadow: 0 8px 25px rgba(239, 179, 68, 0.3);
    }

    .error-list {
        text-align: left;
        background: #fefaf2;
        border: 1px solid #feecca;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
    }

    .error-list ul {
        margin: 0;
        padding-left: 20px;
        color: #5f5100;
    }

    .error-list li {
        margin-bottom: 8px;
        font-size: 14px;
        line-height: 1.4;
    }
</style>

<div class="container" style="min-height: 760px;">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h4 class="text-center" style="padding:5px; padding-top:20px">POLICY SUGGESTION FORM</h4>
            <div style="margin: 5px; margin-bottom: 10px;">
                <p class="text-descr">
                    Thank you for helping us grow the <a class="textab" href="https://peatlandpolicyportal.eu/">Peatland Policy Portal</a>.
                    <br>
                    Please use this form to suggest a policy. Please note that we only include officially published policies at the moment. We do not collect policies in the drafting or consultation stage. 
                    We are currently collecting policies that affect EU member states and the UK. This includes:
                </p>
                <ul style="margin: 0px;">
                    <li><p class="text-descr">Globally and multinationally binding agreements <em>(e.g. the Paris Agreement)</em></p></li>
                    <li><p class="text-descr">European Union policies <em>(e.g. the Nature Restoration Regulation)</em></p></li>
                    <li><p class="text-descr">National government policies <em>(e.g. Germany's National Peatland Protection Strategy)</em></p></li>
                    <li><p class="text-descr">Regional and local policies <em>(e.g. Ireland's Galway County Development Plan 2022 - 2028)</em></p></li>
                </ul>
                <p class="text-descr">
                    Visit the current policy collection at <a class="textab" href="https://peatlandpolicyportal.eu/policy">https://peatlandpolicyportal.eu/policy</a>.
                    <br>
                    If you are unsure about any section, you can add comments in the "Additional information" field at the end of the form.
                    <br>
                    EU-LIFE Multi Peat Team
                </p>
            </div>
            
            <h4 class="text-center" style="padding:10px; color:rgb(0, 128, 0); display: none;" id="message">{{ message }}</h4> 
            
            <div class="pol-coll-div" style="margin-bottom: 10px;">
                <form method="post" class="container" id="policyForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    
                    <span class="d-flex justify-content-between" style="width: 100%;">
                        <h5>Contact Information</h5>
                        <p style="color: red; font-size: 18px;">* indicates required question</p>
                    </span>
                
                    <br>
                    <div class="col-6">
                        <!-- email -->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="By providing your email address, you consent to us contacting you if we have questions about your submission. We will not share or use this email for any other purpose.">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputEmail" class="form-label">Email (optional)</label>
                        <input type="text" class="form-control" id="inputEmail" name="email">
                    </div>
                    
                    <hr class="pol">
                    <h5>Language and Title</h5>
                    <br>
                    <div class="col-6">
                        <!-- language -->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Select the policy's original language">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolLang" class="form-label">Original language of the policy</label>
                        <p style="color: red;" class="d-inline">*</p>
                        <select class="form-select" id="inputPolLang" name="pollang" required>
                            <option value="" selected>Language</option>
                        </select>
                        <br>
                        
                        <!-- original title -->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Enter the policy's original title <br> Example: <br> <em>Aktionsprogramm Nat√ºrlicher Klimaschutz</em> <br> or <em>Scottish National Flood Resilience Strategy</em>">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolNatName" class="form-label">Policy title in original language</label>
                        <p style="color: red;" class="d-inline">*</p>
                        <input type="text" class="form-control" id="inputPolNatName" name="nattitle" required>
                        <br>
                        
                        <!-- english title -->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Enter the English translation of the title <br> Example: <em>German Federal Action Plan on Nature-based Solution for Climate and Biodiversity</em>">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolEngName" class="form-label">Policy title in English (if applicable)</label>
                        <input type="text" class="form-control" id="inputPolEngName" name="engtitle">
                    </div>
                    
                    <hr class="pol">
                    <h5>Governance Level</h5>
                    <br>
                    <div class="col-6">
                        <!--level-->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title='Select the governance level the policy affects.<br>Example: Select "European Union" for EU directives.'>
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolLvl" class="form-label">Governance level</label>
                        <p style="color: red;" class="d-inline">*</p>
                        <select class="form-select" id="inputPolLvl" name="govlvl" required>
                            <option value="" selected>Level</option>
                            <option value="Global">Global</option>
                            <option value="European">European Union</option>
                            <option value="National">National</option>
                            <option value="Regional">Regional</option>
                        </select>
                        <br>
                        
                        <!--country-->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Select the country the policy affects.">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolCtry" class="form-label">Country (if applicable)</label>
                        <select class="form-select" id="inputPolCtry" name="ctry">
                            <option value="" selected>Country</option>
                        </select>
                        <br>
                        
                        <!--region-->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Enter the region and/or local authority that the policy affects.<br>Example: <em>Galway County</em>">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolReg" class="form-label">Region and/or local authority (if applicable)</label>
                        <input type="text" class="form-control" id="inputPolReg" name="reg"/>
                    </div>
                    
                    <hr class="pol">
                    <h5>Publishing Information</h5>
                    <br>
                    <div class="col-6">
                        <!--publication year-->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Enter the year of publication (yyyy)<br>Example: 2021">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolStartDate" class="form-label">Year of publication</label>
                        <input type="text" class="form-control" id="inputPolStartDate" name="startyr"/>
                        <br>
                        
                        <!--publishers-->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Enter the publisher's name in the original language. Separate multiple names with a semicolon.<br>Example: <em>Department of Agriculture; Ministry of the Environment</em>">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolPub" class="form-label">Publisher(s)</label>
                        <input type="text" class="form-control" id="inputPolPub" name="polpub"/>
                    </div>
                    
                    <hr class="pol">
                    <h5>Policy Information</h5>
                    <br>
                    <div class="col-6">
                        <!-- link to policy page -->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Please link to the official government website that provides additional policy information. You can provide a link to the policy document itself in the next field.">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolPageLnk" class="form-label">Link to policy information page</label>
                        <p style="color: red;" class="d-inline">*</p>
                        <input type="text" class="form-control" id="inputPolPageLnk" name="pglnk" required/>
                        <br>
                        
                        <!-- link to policy pdf -->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Enter the link to the official PDF">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label for="inputPolPdfLnk" class="form-label">Link to PDF of the policy</label>
                        <input type="text" class="form-control" id="inputPolPdfLnk" name="pdflnk"/>
                        <br>
                        
                        <!--categories-->
                        <svg height="20" width="16">
                            <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Select the policy's area(s) of impact">
                                <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                            </a>
                        </svg>
                        <label class="form-label">Policy Domain</label>
                        <a class="btn w-100 btn-ddw dropdown-toggle" id="inputPoldropbtn" href="#" role="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false" style="font-size: 16px; border-radius: 10px; border-width:2px; padding-top:10px; padding-bottom:10px; border-color: whitesmoke;">
                            Select categories
                        </a>
                        <ul class="col-4 dropdown-menu" style="padding:0px; max-width: 20%;">
                            <div class="bio-cls-clr">
                                <input id="bio-cls-bx-ps" name="bio-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="bio-cls-bx-ps">Biodiversity</label>
                            </div>
                            <div class="clm-cls-clr">
                                <input id="clm-cls-bx-ps" name="clm-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="clm-cls-bx-ps">Climate Action</label>
                            </div>
                            <div class="comm-cls-clr">
                                <input id="comm-cls-bx-ps" name="comm-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="comm-cls-bx-ps">Culture</label>
                            </div>
                            <div class="econ-cls-clr">
                                <input id="econ-cls-bx-ps" name="econ-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="econ-cls-bx-ps">Economy</label>
                            </div>
                            <div class="enr-cls-clr">
                                <input id="enr-cls-bx-ps" name="enr-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="enr-cls-bx-ps">Energy</label>
                            </div>
                            <div class="env-cls-clr">
                                <input id="env-cls-bx-ps" name="env-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="env-cls-bx-ps" style="margin-right: 5px;">Environmental Quality</label>
                            </div>
                            <div class="land-cls-clr">
                                <input id="land-cls-bx-ps" name="land-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="land-cls-bx-ps">Land Use</label>
                            </div>
                            <div class="res-cls-clr">
                                <input id="res-cls-bx-ps" name="res-cls" type="checkbox" class="form-check-input pol-cls-inp">
                                <label class="form-label" for="res-cls-bx-ps">Research</label>
                            </div>
                        </ul>
                    </div>
                    <br>
                    
                    <!-- relevance to peatland -->
                    <svg height="20" width="16">
                        <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Briefly explain the policy's relevance to peatland (e.g., conservation, restoration, extraction).">
                            <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                        </a>
                    </svg>
                    <label for="inputPolRelev" class="form-label">Relevance to peatlands</label>
                    <textarea class="form-control" id="inputPolRelev" name="relev"></textarea>
                    <br>
                    
                    <!-- additional information -->
                    <svg height="20" width="16">
                        <a data-bs-toggle="tooltip" data-bs-placement="left" data-bs-custom-class="tooltip-inner" data-bs-html="true" data-bs-title="Please leave a comment or provide any other details here">
                            <image xlink:href="{{ url_for('static', filename='INFO-icon-darker.png') }}" style="height:20px; width:16px"></image>                            
                        </a>
                    </svg>
                    <label for="inputPolAddtl" class="form-label">Additional information</label>
                    <textarea class="form-control" id="inputPolAddtl" name="addtl"></textarea>
                    
                    <!-- submit -->
                    <div class="row justify-content-center" style="margin-top: 15px;">
                        <div class="col-md-3">
                            <button id="inputPolSub" type="submit" class="btn btn-success">Submit</button>
                        </div>
                    </div>
                </form>
            </div>   
        </div>
    </div>
</div>

<!-- Success Popup -->
<div class="popup-overlay" id="successPopup">
    <div class="popup-content">
        <div class="success-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
        </div>
        <h3 class="popup-title">Thank you for your suggestion!</h3>
        <p class="popup-message">We have received your submission.</p>
        <button class="popup-close-btn" onclick="closeSuccessPopup()">Continue</button>
    </div>
</div>

<!-- Error Popup -->
<div class="popup-overlay error-popup" id="errorPopup">
    <div class="popup-content">
        <div class="error-icon">
            <svg fill="none" stroke="currentColor" viewBox="-2 -1 20 20">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
            </svg>
        </div>
        <h3 class="popup-title">Please check your submission</h3>
        <p class="popup-message">Please complete the required field(s) below:</p>
        <div class="error-list" id="errorList">
            <!-- Error messages will be inserted here -->
        </div>
        <button class="popup-close-btn" onclick="closeErrorPopup()">Return to Form</button>
    </div>
</div>

<script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Form submission with loading state and popup
        const submitBtn = document.getElementById('inputPolSub');
        const form = document.getElementById('policyForm');
        
        if (submitBtn && form) {
            submitBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Validate form before submission
                const validationErrors = validateForm();
                
                if (validationErrors.length > 0) {
                    showErrorPopup(validationErrors);
                    return;
                }
                
                // Add loading state to button
                const originalText = this.innerHTML;
                this.innerHTML = '<span class="loading-spinner"></span>Submitting...';
                this.classList.add('btn-loading');
                
                // Create form data
                const formData = new FormData(form);
                
                // Submit form via fetch
                fetch(form.action || window.location.pathname, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    // Reset button
                    this.innerHTML = originalText;
                    this.classList.remove('btn-loading');
                    
                    if (response.ok) {
                        // Show success popup and reset form
                        showSuccessPopup();
                        form.reset();
                    } else {
                        // Handle server error
                        return response.text().then(text => {
                            throw new Error(`Server error: ${response.status}`);
                        });
                    }
                })
                .catch(error => {
                    // Reset button
                    this.innerHTML = originalText;
                    this.classList.remove('btn-loading');
                    
                    // Show error popup
                    console.error('Form submission error:', error);
                    showErrorPopup(['Form submission failed. Please try again.']);
                });
            }.bind(submitBtn));
        } else {
            console.error('Submit button or form not found');
        }
    });

    // URL validation function
    function isValidURL(string) {
        try {
            const url = new URL(string);
            return url.protocol === 'http:' || url.protocol === 'https:';
        } catch (_) {
            return false;
        }
    }

    // Form validation function
    function validateForm() {
        const errors = [];
        
        // Get the policy page link
        const policyPageLink = document.getElementById('inputPolPageLnk').value.trim();
        const policyPdfLink = document.getElementById('inputPolPdfLnk').value.trim();
        
        // Validate policy information page link (required)
        if (!policyPageLink) {
            errors.push('Policy information page link is required');
        } else if (!isValidURL(policyPageLink)) {
            errors.push('Policy information page link must be a valid URL (e.g., https://example.com)');
        }
        
        // Validate PDF link (optional, but if provided must be valid)
        if (policyPdfLink && !isValidURL(policyPdfLink)) {
            errors.push('PDF link must be a valid URL (e.g., https://example.com/document.pdf)');
        }
        
        // Additional URL format checks
        if (policyPageLink && isValidURL(policyPageLink)) {
            const pageUrl = new URL(policyPageLink);
            if (pageUrl.hostname.length < 3) {
                errors.push('Policy information page URL appears to be invalid');
            }
        }
        
        if (policyPdfLink && isValidURL(policyPdfLink)) {
            const pdfUrl = new URL(policyPdfLink);
            if (pdfUrl.hostname.length < 3) {
                errors.push('PDF URL appears to be invalid');
            }
        }
        
        return errors;
    }

    function showSuccessPopup() {
        const popup = document.getElementById('successPopup');
        popup.classList.add('show');
        
        // Prevent body scroll when popup is open
        document.body.style.overflow = 'hidden';
    }

    function showErrorPopup(errors) {
        const popup = document.getElementById('errorPopup');
        const errorList = document.getElementById('errorList');
        
        // Create error list HTML
        let errorHTML = '<ul>';
        errors.forEach(error => {
            errorHTML += `<li>${error}</li>`;
        });
        errorHTML += '</ul>';
        
        errorList.innerHTML = errorHTML;
        popup.classList.add('show');
        
        // Prevent body scroll when popup is open
        document.body.style.overflow = 'hidden';
    }

    function closeSuccessPopup() {
        const popup = document.getElementById('successPopup');
        popup.classList.remove('show');
        
        // Restore body scroll
        document.body.style.overflow = 'auto';
        
        // Optional: Reset form (already done in submission handler)
        // document.getElementById('policyForm').reset();
    }

    function closeErrorPopup() {
        const popup = document.getElementById('errorPopup');
        popup.classList.remove('show');
        
        // Restore body scroll
        document.body.style.overflow = 'auto';
    }

    // Close popups when clicking overlay
    document.getElementById('successPopup').addEventListener('click', function(e) {
        if (e.target === this) {
            closeSuccessPopup();
        }
    });

    document.getElementById('errorPopup').addEventListener('click', function(e) {
        if (e.target === this) {
            closeErrorPopup();
        }
    });

    // Close popups with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeSuccessPopup();
            closeErrorPopup();
        }
    });

    // Populate country selection
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var obj = JSON.parse(this.responseText)['result']['response'];
            obj.forEach(entry => {
                const element = `<option value="${entry['id']}">${entry['name']}</option>`;
                const ctry_sel = document.getElementById('inputPolCtry');
                if (ctry_sel) {
                    ctry_sel.insertAdjacentHTML('beforeend', element);
                }
            });
        }
    };
    xhttp.open("GET", "/countrydata", true);
    xhttp.send();

    // Populate language selection
    var xhttp2 = new XMLHttpRequest();
    xhttp2.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var obj = JSON.parse(this.responseText)['result']['response'];
            const lang_sel = document.getElementById('inputPolLang');
            if (lang_sel) {
                obj.forEach(entry => {
                    const element = `<option value="${entry['id']}" label="${entry['name']}">${entry['name']}</option>`;
                    lang_sel.insertAdjacentHTML('beforeend', element);
                });
            }
        }
    };
    xhttp2.open("GET", "/languagedata", true);
    xhttp2.send();
</script>

<!--popover script-->
<script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
</script>

{% endblock %}
